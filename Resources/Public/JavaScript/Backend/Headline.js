"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}define(["TYPO3/CMS/Backend/AjaxDataHandler","TYPO3/CMS/Z7Semantilizer/Backend/Converter"],function(i,t){var s=function(){function n(e,t,i){_classCallCheck(this,n),this._table=e,this._uid=t,this._field=i}return _createClass(n,[{key:"table",get:function(){return this._table},set:function(e){this._table=(e||"").trim()}},{key:"uid",get:function(){return this._uid},set:function(e){this._uid=t.toInteger(e)}},{key:"field",get:function(){return this._field},set:function(e){this._field=(e||"").trim()}}]),n}(),n=_createClass(function e(t,i){_classCallCheck(this,e),this.key=t,this.fix=i}),r=function(){function t(e){_classCallCheck(this,t),this.list={},this.list[t.mainHeadingRequired]=null,this.list[t.mainHeadingNumber]=null,this.list[t.mainHeadingPosition]=null,this.list[t.headingStructure]=null,this.parent=e}return _createClass(t,[{key:"count",value:function(){var t=this,i=0;return Object.keys(this.list).forEach(function(e){return i+=t.list[e]?1:0}),i}},{key:"empty",value:function(){return 0===this.count()}},{key:"add",value:function(e,t){"undefined"!==this.list[e]?this.list[e]=new n(e,t):console.warn('Not allowed error key "'+e+'"',1641814278)}},{key:"each",value:function(t){var i=this;return Object.keys(this.list).filter(function(e){return i.list[e]}).forEach(function(e){return t(i.list[e],e)})}},{key:"get",value:function(e){return this.list[e]||null}},{key:"has",value:function(e){return null!==this.get(e)}},{key:"remove",value:function(e){this.list[e]=null}},{key:"clear",value:function(){var t=this;Object.keys(this.list).forEach(function(e){return t.list[e]=null})}},{key:"fix",value:function(e,t){var i=this.get(e);i&&i.fix&&this.parent.isEditableType()&&(this.parent.type=i.fix,this.remove(e),void 0!==t&&this.parent.store())}}]),t}();return _defineProperty(r,"mainHeadingRequired","mainHeadingRequired"),_defineProperty(r,"mainHeadingNumber","mainHeadingNumber"),_defineProperty(r,"mainHeadingPosition","mainHeadingPosition"),_defineProperty(r,"headingStructure","headingStructure"),function(){function n(e,t){if(_classCallCheck(this,n),this.type=e.nodeName,this.text=e.innerText,this.parent=t,this.edit=new s,this.issues=new r(this),e.dataset.semantilizer)try{var i=JSON.parse(e.dataset.semantilizer);this.edit.table=i.table,this.edit.uid=i.uid,this.edit.field=i.field}catch(e){"function"==typeof console.log&&console.log(e,1640904719)}this.showIssues=this.showIssues.bind(this)}return _createClass(n,[{key:"type",get:function(){return this._type},set:function(e){return this._type=Math.min(Math.max(t.toInteger(e),1),6),this}},{key:"text",get:function(){return this._text},set:function(e){return this._text=e.trim(),this}},{key:"store",value:function(e){if(this.isEditableType())return n.storeHeadlines([this],e)}},{key:"getEditUrl",value:function(){if(this.isEditableRecord()){var e=encodeURIComponent(top.list_frame.document.location.pathname+top.list_frame.document.location.search);return top.TYPO3.settings.FormEngine.moduleUrl+"&edit["+this.edit.table+"]["+this.edit.uid+"]=edit&returnUrl="+e}return null}},{key:"isEditableRecord",value:function(){return this.edit.table&&this.edit.uid}},{key:"isEditableType",value:function(){return this.isEditableRecord()&&this.edit.field}},{key:"showIssues",value:function(){var i=this;this.issues.count()&&this.issues.each(function(e,t){return i.parent.notifications.showIssue(t)})}}],[{key:"storeHeadlines",value:function(e,t){var s={data:{}};e.forEach(function(e){var t,i,n;e.isEditableType()&&(t=e.edit.table,i=e.edit.uid,n=e.edit.field,s.data[t]=s.data[t]||{},s.data[t][i]={},s.data[t][i][n]=e.type)}),Object.keys(s).length&&i.process(s).done(function(e){return"function"==typeof t&&t(e)})}}]),n}()});