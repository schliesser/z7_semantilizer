"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}define(["TYPO3/CMS/Backend/Notification","TYPO3/CMS/Backend/ActionButton/ImmediateAction","TYPO3/CMS/Z7Semantilizer/Backend/Converter","TYPO3/CMS/Z7Semantilizer/Backend/Headline","TYPO3/CMS/Z7Semantilizer/Backend/Module","TYPO3/CMS/Z7Semantilizer/Backend/Edit","TYPO3/CMS/Z7Semantilizer/Backend/Translate"],function(a,o,i,u,l,c,s){var d=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"mainHeadingRequired",value:function(e,t){e.addError("mainHeadingRequired",4,t)}},{key:"mainHeadingNumber",value:function(e,t){e.addError("mainHeadingNumber",2,t,"info")}},{key:"mainHeadingPosition",value:function(e,t){e.addError("mainHeadingPosition",3,t)}},{key:"headingStructure",value:function(e,t){e.addError("headingStructure",1,t)}}]),e}();return function(){function r(e,t,n){_classCallCheck(this,r),_defineProperty(this,"headlines",[]),_defineProperty(this,"url",void 0),_defineProperty(this,"contentSelectors",void 0),_defineProperty(this,"module",void 0),this.url=e,this.contentSelectors=i.toArray(n),this.module=new l(document.getElementById(t),this),this.init()}return _createClass(r,[{key:"collect",value:function(e){var r=this,t=new XMLHttpRequest;this.headlines.length=0,t.onreadystatechange=function(){var n;4===t.readyState&&(200===t.status&&(n=(new DOMParser).parseFromString(t.responseText,"text/html"),r.contentSelectors.map(function(e){return n.querySelector(e)}).filter(function(e){return e}).forEach(function(e){var t;(t=r.headlines).push.apply(t,_toConsumableArray(i.toArray((e||n).querySelectorAll("h1, h2, h3, h4, h5, h6")).map(function(e){return new u(e)})))})),"function"==typeof e&&e(t))},t.open("GET",this.url,!0),t.send()}},{key:"validateStructure",value:function(){var n=this;this.headlines.forEach(function(e){return e.error.length=0});function e(){n.headlines.forEach(function(e,t){t&&e.type>n.headlines[t-1].type+1&&d.headingStructure(e)})}var t,r;this.headlines.length&&(t=n.headlines[0],0===(r=n.headlines.filter(function(e){return 1===e.type})).length&&d.mainHeadingRequired(t,1),1<r.length&&n.headlines.forEach(function(e,t){t&&1===e.type&&d.mainHeadingNumber(e,2)}),1===r.length&&1!==t.type&&(d.mainHeadingPosition(t,1),n.headlines.forEach(function(e,t){t&&1===e.type&&d.mainHeadingPosition(e,2)})),e())}},{key:"showNotifications",value:function(){var r=this,i={};this.headlines.filter(function(e){return e.error.length}).forEach(function(t){return t.error.forEach(function(e){i[e.code]=i[e.code]||{layout:e.layout,fix:[]},e.fix&&t.edit&&t.edit.table&&t.edit.uid&&t.edit.field&&i[e.code].fix.push([e.fix,t])})}),Object.keys(i).forEach(function(e){var t=i[e].fix.length,n=[];t&&n.push({label:s("notification.fix")+(1<t?" ("+t+")":""),action:new o(function(){return c.updateTypes(i[e].fix.map(function(e){return{type:e[0],headline:e[1]}}),function(){r.validate(),a.success(s("notification.fixed.title"),s("notification."+e+".title"),4)})})}),a[i[e].layout](s("notification."+e+".title"),s("notification."+e+".description"),10,n)})}},{key:"hideAllNotifications",value:function(){var t=a.messageContainer;t&&i.toArray(t.childNodes).forEach(function(e){return t.removeChild(e)})}},{key:"validate",value:function(){this.validateStructure(),this.hideAllNotifications(),this.showNotifications(),this.module.drawStructure()}},{key:"refresh",value:function(e){var t=this;this.collect(function(){"function"==typeof e&&e(),t.module.setHeadlines(t.headlines),t.validate()})}},{key:"init",value:function(){var t=this;this.refresh(),this.module.loader(),require(["jquery","jquery-ui/droppable"],function(e){return e(".t3js-page-ce-dropzone-available").on("drop",function(){t.module.lockStructure(),t.refresh()})})}}]),r}()});