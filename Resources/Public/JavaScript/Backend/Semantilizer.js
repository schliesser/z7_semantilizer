"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}define(["TYPO3/CMS/Backend/Notification","TYPO3/CMS/Backend/ActionButton/ImmediateAction"],function(n,r){function a(e){_classCallCheck(this,a),_defineProperty(this,"type",0),_defineProperty(this,"text",""),_defineProperty(this,"error",[]),_defineProperty(this,"table",""),_defineProperty(this,"id",0),this.type=s.toInteger(e.nodeName),this.text=e.innerText.trim(),this.table=e.dataset.semantilizerTable,this.id=s.toInteger(e.dataset.semantilizerUid)}var s=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"toArray",value:function(e){return Array.prototype.slice.call(e)}},{key:"toInteger",value:function(e){var t=parseInt(e);return isNaN(t)?parseInt((e||"").replace(/[^0-9]/i,"")):t}}]),e}(),o=function(){function t(e){return _classCallCheck(this,t),this.element=document.createElement(e||"div"),this}return _createClass(t,[{key:"setAttribute",value:function(e,t){return this.element.setAttribute(e,t),this}},{key:"setAttributes",value:function(t){var n=this;return Object.keys(t).forEach(function(e){return n.setAttribute(e,t[e])}),this}},{key:"setStyles",value:function(t){var n=this;return this.element&&t&&Object.keys(t).forEach(function(e){n.element.style[e]=t[e]}),this}},{key:"setClassName",value:function(e){return this.element.className=e,this}},{key:"setBemClassName",value:function(e,t,n){return this.setClassName((n||"semantilizer")+(e?"__"+e:"")+(t?"--"+t:""))}},{key:"setContent",value:function(e){return this.element.innerHTML=e,this}},{key:"appendTo",value:function(e){return e.appendChild(this.render())}},{key:"render",value:function(){return this.element}}]),t}(),l=function(){function t(e){_classCallCheck(this,t),_defineProperty(this,"element",null),_defineProperty(this,"headlines",[]),this.element=e,this.init()}return _createClass(t,[{key:"setHeadlines",value:function(e){this.headlines=e}},{key:"clearContent",value:function(e){for(var t;t=(e||this.element).firstElementChild;)(e||this.element).removeChild(t)}},{key:"drawList",value:function(){var e=new o("div").setBemClassName("listwrap").appendTo(this.element),a=new o("ul").setBemClassName("list").appendTo(e);this.headlines.forEach(function(e){for(var t=new o("li").setBemClassName("item",e.type).appendTo(a),n=new o("select").setBemClassName("select").appendTo(t),i=1;i<=6;i++){var r=new o("option").setAttributes({value:"url"}).setContent("H"+i).appendTo(n);e.type===i&&(r.selected=!0)}new o("a").setAttribute("href","#").setContent(e.text).appendTo(t)})}},{key:"draw",value:function(){this.clearContent(),this.drawList()}},{key:"init",value:function(){}}]),t}(),u=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"mainHeadingRequired",value:function(e,t){e.error.push({code:"mainHeadingRequired",priority:4,fix:t})}},{key:"mainHeadingNumber",value:function(e,t){e.error.push({code:"mainHeadingNumber",priority:2,fix:t})}},{key:"mainHeadingPosition",value:function(e,t){e.error.push({code:"mainHeadingPosition",priority:3,fix:t})}},{key:"headingStructure",value:function(e,t){e.error.push({code:"headingStructure",priority:1,fix:t})}}]),e}();return function(){function i(e,t,n){_classCallCheck(this,i),_defineProperty(this,"headlines",[]),_defineProperty(this,"url",void 0),_defineProperty(this,"containerSelector",void 0),_defineProperty(this,"module",void 0),this.url=e,this.containerSelector=n,this.module=new l(document.getElementById(t)),this.init()}return _createClass(i,[{key:"collect",value:function(n){var i=this,r=new XMLHttpRequest;r.onreadystatechange=function(){var e,t;4===r.readyState&&(200===r.status?(e=(new DOMParser).parseFromString(r.responseText,"text/html"),t=i.containerSelector?e.querySelector(i.containerSelector):null,i.headlines=s.toArray((t||e).querySelectorAll("h1, h2, h3, h4, h5, h6")).map(function(e){return new a(e)}),"function"==typeof n&&n(r)):i.error={request:r})},r.open("GET",this.url,!0),r.send()}},{key:"validate",value:function(){var e,t,n=this;e=n.headlines[0],0===(t=n.headlines.filter(function(e){return 1===e.type})).length&&u.mainHeadingRequired(e,1),1<t.length&&n.headlines.forEach(function(e,t){t&&1===e.type&&u.mainHeadingNumber(e,2)}),1===t.length&&1!==e.type&&(u.mainHeadingPosition(e,1),n.headlines.forEach(function(e,t){t&&1===e.type&&u.mainHeadingPosition(e,2)})),n.headlines.forEach(function(e,t){t&&e.type>n.headlines[t-1].type+1&&u.headingStructure(e)})}},{key:"showNotifications",value:function(){this.headlines.filter(function(e){return e.error.length}).forEach(function(t){t.error.forEach(function(e){n.warning(e.code,t.text,5,[{label:"Close message",action:new r(function(){return!0})},{label:"Fix error",action:new r(function(){return n.success("fixed!","",1)})}])})})}},{key:"revalidate",value:function(){this.headlines.forEach(function(e){return e.error.length=0}),this.validate()}},{key:"refresh",value:function(e){var t=this;this.collect(function(){t.validate(),"function"==typeof e&&e(),t.module.setHeadlines(t.headlines),t.module.draw(),t.showNotifications()})}},{key:"init",value:function(){this.refresh()}}]),i}()});