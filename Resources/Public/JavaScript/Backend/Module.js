"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}define(["TYPO3/CMS/Backend/Icons","TYPO3/CMS/Z7Semantilizer/Backend/Translate"],function(e,c){var u=function(){function t(e){return _classCallCheck(this,t),this.element=document.createElement(e||"div"),this}return _createClass(t,[{key:"setAttribute",value:function(e,t){return this.element.setAttribute(e,t),this}},{key:"setAttributes",value:function(t){var n=this;return Object.keys(t).forEach(function(e){return n.setAttribute(e,t[e])}),this}},{key:"setStyles",value:function(t){var n=this;return this.element&&t&&Object.keys(t).forEach(function(e){n.element.style[e]=t[e]}),this}},{key:"setClassName",value:function(e){return this.element.className=e,this}},{key:"setBemClassName",value:function(e,t,n){return this.setClassName((n||"semantilizer")+(e?"__"+e:"")+(t?"--"+t:""))}},{key:"setContent",value:function(e){return this.element.innerHTML=e,this}},{key:"appendTo",value:function(e){return e.appendChild(this.render())}},{key:"render",value:function(){return this.element}}]),t}();return function(){function n(e,t){_classCallCheck(this,n),_defineProperty(this,"element",void 0),_defineProperty(this,"parent",void 0),this.element=e,this.parent=t,this.init()}return _createClass(n,[{key:"clearContent",value:function(e){for(var t;t=(e||this.element).firstElementChild;)(e||this.element).removeChild(t)}},{key:"drawDescription",value:function(){this.parent.headlines.length&&new u("p").setContent(c("overview.description")).appendTo(this.element)}},{key:"drawList",value:function(){var e,o,l=this;this.parent.headlines.length?(e=new u("div").setBemClassName("listwrap").appendTo(this.element),o=new u("ul").setBemClassName("list").appendTo(e),this.parent.headlines.forEach(function(n,e){var t=new u("li").setBemClassName("item","level"+n.type).appendTo(o);if(n.isEditableType()){for(var i=new u("select").setBemClassName("control","level"+n.type).setAttribute("data-index",e).appendTo(t),a=1;a<=6;a++){var s=new u("option").setAttributes({value:a}).setContent("H"+a).appendTo(i);n.type===a&&(s.selected=!0)}i.addEventListener("change",function(e){n.type=e.target.options[e.target.selectedIndex].value,n.store(function(e,t){return!e.hasErrors&&l.parent.revalidate(t)})})}else{var r=new u("button").setBemClassName("control","level"+n.type).setAttribute("type","button").setContent("H"+n.type).appendTo(t);n.isRelated()&&n.relatedHeadline().isEditableType()?(r.setAttribute("data-related-to",n.edit.relatedTo),r.addEventListener("click",function(e){var t=o.querySelectorAll('[data-index="'+l.parent.headlines.indexOf(n.relatedHeadline())+'"]');t&&t[t.length-1].focus(),e.preventDefault()})):r.disabled="disabled"}r=n.issues.count();(n.isEditableRecord()?new u("a").setAttribute("href",n.getEditUrl()):new u("span")).setContent(n.text).setBemClassName("headline",r?"error":"").appendTo(t),r&&new u("button").setAttributes({type:"button",title:c("overview.notification.show")}).setBemClassName("issue-info").appendTo(t).addEventListener("click",n.showIssues)}),this.wrap=e):new u("p").setContent(c("overview.empty")).appendTo(this.element)}},{key:"drawNotificationToggle",value:function(){var n=this,i=this.parent.notifications.autoload.enabled();e.getIcon(i?"actions-toggle-on":"actions-toggle-off",e.sizes.small).then(function(e){var t=new u("button").setAttribute("type","button").setContent(c(i?"overview.notifications.on":"overview.notifications.off")).setBemClassName("notifications-toggle").appendTo(n.element);t.insertAdjacentHTML("afterbegin",e+" "),t.addEventListener("click",function(){i?(n.parent.notifications.hideAll(),n.parent.notifications.autoload.disable()):(n.parent.notifications.showIssues(),n.parent.notifications.autoload.enable()),n.element.removeChild(t),n.drawNotificationToggle()})})}},{key:"lockStructure",value:function(){this.parent.notifications.hideAll();var e=new u("div").setBemClassName("lock").appendTo(this.wrap);new u("span").setBemClassName("lock-message").setContent(c("overview.update")).appendTo(e)}},{key:"drawStructure",value:function(){this.clearContent(),this.drawDescription(),this.drawList(),this.drawNotificationToggle()}},{key:"drawError",value:function(){this.clearContent(),new u("p").setContent(c("overview.error")).appendTo(this.element)}},{key:"loader",value:function(){var t=this;e.getIcon("spinner-circle",e.sizes.small).then(function(e){t.element.insertAdjacentHTML("beforeend",e+'<span style="margin-left: 0.3em">'+c("overview.loading")+"</span>")})}},{key:"init",value:function(){this.clearContent()}}]),n}()});